==deffile==
Bootstrap: docker
From: ubuntu:18.04

%post

  sudo apt-get update
  sudo apt install -y dialog=1.3-20201126-1
  # Local related configuration
  sudo apt-get install -y locales
  echo "en_US.UTF-8 UTF-8" >> /etc/locale.gen
  locale-gen
  update-locale "LANG=en_US.UTF-8"

  # Development Libraries for ubuntu (Try to lock down versions)
  sudo apt-get install -y \
    build-essential \
    libssl-dev \
    uuid-dev \
    libgpgme11-dev \
    squashfs-tools \
    libseccomp-dev \
    wget=1.21-1+b1 \
    apt-get install -y zip=3.0-12 \
    apt-get install -y perl=5.32.1-4+deb11u2 \
    pkg-config \
    git \
    cryptsetup

  #STAR
  mkdir -pv /opt/
  cd /opt/
  wget https://github.com/alexdobin/STAR/archive/2.7.9a.tar.gz
  tar -xzf 2.7.9a.tar.gz
  rm -v 2.7.9a.tar.gz
  mv -fv STAR-2.7.9a STAR
  ln -sv /opt/STAR/bin/Linux_x86_64/* /usr/local/bin

  #GATK
  cd /opt/
  export GATK_PACKAGE="gatk.zip"
  wget -O $GATK_PACKAGE https://github.com/broadinstitute/gatk/releases/download/4.2.2.0/gatk-4.2.2.0.zip
  unzip ${GATK_PACKAGE}
  rm -v ${GATK_PACKAGE}
  ln -svf /opt/gatk/gatk-4.2.2.0/gatk* /usr/local/bin/

  #GAPIT3
  sudo Rscript -e 'install.packages("nloptr")'
  sudo Rscript -e 'install.packages("rgl")'

  Rscript -e 'install.packages("devtools")'
  Rscript -e 'devtools::install_github("jiabowang/GAPIT3",force=TRUE)'
  R>library(GAPIT3)

  #BLINK
  Rscript -e 'devtools::install_github("YaoZhou89/BLINK")'

  ##FastQC, Trimmomatic, R, ggplot2, DESeq2, samtools, HISAT2, featureCounts
  #FastQC
  apt-get install -y default-jre=2:1.11-68ubuntu1~18.04.1
  sudo mkdir -pv /opt/fastqc
  cd /opt/fastqc
  sudo chown -Rv $(whoami):$(whoami) /opt/fastqc
  wget https://www.bioinformatics.babraham.ac.uk/projects/fastqc/fastqc_v0.11.9.zip
  unzip fastqc_v0.11.9.zip
  rm -v fastqc_v0.11.9.zip
  mv -v FastQC/* .
  rmdir -v FastQC
  chmod -v ugo+x fastqc
  sudo ln -sv /opt/fastqc/fastqc /usr/local/bin/

  #Trimmomatic
  apt-get -y install trimmomatic=0.36+dfsg-3

  #Cutadapt
  apt-get -y install cutadapt=1.15-1

  ##DESeq2
  Rscript -e 'BiocManager::install("DESeq2")'

  ## edgeR, limma, (Install edgeR 1st and limma will be automatically installed)
  Rscript -e 'BiocManager::install("edgeR")'

  #samtools:
  apt-get install -y samtools=1.7-1

  #HISAT2:
  apt-get install -y hisat2=2.1.0-1

  #Subread, featureCounts
  apt-get -y install subread=1.6.0+dfsg-1

  ##HTSeq: The following worked on Ubuntu 18.04
  sudo apt-get -y install python-htseq=0.6.1p1-4build1

  ##Docker:
  sudo apt-get -y install docker=1.5-1build1

  ##BWA:
  sudo apt-get -y install bwa=0.7.17-1

  ##Snakemake:
  sudo apt-get -y install snakemake=4.3.1-1

  ##Nextflow
  sudo mkdir -pv /opt/nextflow/
  cd /opt/nextflow/
  sudo curl -s https://get.nextflow.io | sudo bash
  sudo ln -sv /opt/nextflow/nextflow /usr/bin/
  sudo /opt/nextflow/nextflow self-update
  nextflow -version

  #TrimGalore:
  cd /opt
  sudo wget https://github.com/FelixKrueger/TrimGalore/archive/0.6.0.tar.gz -O trim_galore.tar.gz
  sudo tar xvzf trim_galore.tar.gz
  rm -v trim_galore.tar.gz
  sudo ln -sv /opt/TrimGalore-0.6.0/trim_galore /usr/local/bin/

  #MultiQC
  cd /opt
  sudo wget https://files.pythonhosted.org/packages/6a/f0/122025f4521fd085c07d7a706f08819b4c6bed9e62cfe99453f8c5968ab9/multiqc-1.12.tar.gz
  sudo tar xvzf multiqc-1.12.tar.gz
  sudo rm -v multiqc-1.12.tar.gz
  cd multiqc-1.12/
  sudo python setup.py install

%runscript
  echo "This container is based on Ubuntu 18.04"
  echo
  #spit out software versions

  #Data Download Tools: These packages come with the VM
  wget --version | head -1
  zip --version | head -2 | tail -1 | sed 's/^This is //'
  perl --version | head -2 | tail -1 | sed 's/^This is p/P/'
  python --version | head -2 | tail -1 | sed 's/^ *//'
  python3 --version | head -2 | tail -1 | sed 's/^ *//'

  #Bionformatics Tools:
  alias trimmomatic='java -jar /usr/share/java/trimmomatic-0.36.jar'
  echo -n "trimmomatic: "; trimmomatic -version | head -n 1
  fastqc --version
  R --version | head -n 1
  echo -n "Bioconductor:"; Rscript -e 'BiocManager::version()' | sed 's/\[1]//' | sed 's/‘//g' | sed 's/’//g' ## Display the Bioconductor version (formatted)
  echo -n "ggplot2:"; Rscript -e 'packageVersion("ggplot2")' | sed 's/\[1]//' | sed 's/‘//g' | sed 's/’//g' ## Display the ggplot2 version
  echo -n "GAPIT:"; Rscript -e 'packageVersion("GAPIT3")' | sed 's/\[1]//' | sed 's/‘//g' | sed 's/’//g'
  echo -n "BLINK:"; Rscript -e 'packageVersion("BLINK")' | sed 's/\[1]//' | sed 's/‘//g' | sed 's/’//g'
  echo -n "Cutadapt: "; cutadapt --version
  echo -n "DESeq2:"; Rscript -e 'packageVersion("DESeq2")' | sed 's/\[1]//' | sed 's/‘//g' | sed 's/’//g'
  samtools --version | head -n 1
  hisat2 --version | head -1
  subread-align -version 2>&1 | sed '/^$/d'
  featureCounts -v 2>&1 | sed '/^$/d'
  echo -n "edgeR:"; Rscript -e 'packageVersion("edgeR")' | sed 's/\[1]//' | sed 's/‘//g' | sed 's/’//g' ## Display the edgeR version
  echo -n "limma:"; Rscript -e 'packageVersion("limma")' | sed 's/\[1]//' | sed 's/‘//g' | sed 's/’//g' ## Display the limma version
  gatk --version 2>&1 | head -3
  echo -n "snakemake: "; snakemake --version
  echo -n "Nextflow: "; sudo nextflow -version | head -3 | tail -1 | sed 's/^ *//'
  echo -n "trim_galore: "; trim_galore --version | tail -4 | head -1
  htseq-count -h | tail -1 | sed 's/^Public License v3. Part of the //'
  multiqc --version
  echo -n "BWA "; bwa 2>&1 | head -3 | tail -1

%labels
  Author laitanawe@gmail.com
  Version 0.1
  Date jan15_2022

%help
  This definition file builds packages for multi-omic data analysis.
